<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mobx 使用总结 | 时羽·前端知识库</title>
    <meta name="description" content="前端,前端工程师,前端自学,前端进阶,前端发展">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.82c487b9.css" as="style"><link rel="preload" href="/assets/js/app.5e1dc976.js" as="script"><link rel="preload" href="/assets/js/2.654fa9b9.js" as="script"><link rel="preload" href="/assets/js/6.c776911c.js" as="script"><link rel="prefetch" href="/assets/js/10.db9dd162.js"><link rel="prefetch" href="/assets/js/11.541d9850.js"><link rel="prefetch" href="/assets/js/12.ef8e0289.js"><link rel="prefetch" href="/assets/js/13.92ccc43f.js"><link rel="prefetch" href="/assets/js/14.ec3c53ba.js"><link rel="prefetch" href="/assets/js/15.0dc7c2d6.js"><link rel="prefetch" href="/assets/js/16.13f647c2.js"><link rel="prefetch" href="/assets/js/17.d92c65dc.js"><link rel="prefetch" href="/assets/js/18.fd317fd4.js"><link rel="prefetch" href="/assets/js/19.cafa0f78.js"><link rel="prefetch" href="/assets/js/20.e718caca.js"><link rel="prefetch" href="/assets/js/21.d18a0b10.js"><link rel="prefetch" href="/assets/js/22.4bd61e16.js"><link rel="prefetch" href="/assets/js/23.342b190f.js"><link rel="prefetch" href="/assets/js/24.42563896.js"><link rel="prefetch" href="/assets/js/25.d1702b91.js"><link rel="prefetch" href="/assets/js/26.b5410708.js"><link rel="prefetch" href="/assets/js/27.b55f6f90.js"><link rel="prefetch" href="/assets/js/28.509d6c21.js"><link rel="prefetch" href="/assets/js/29.402fa13a.js"><link rel="prefetch" href="/assets/js/3.e19b672f.js"><link rel="prefetch" href="/assets/js/30.02277e72.js"><link rel="prefetch" href="/assets/js/31.932846f5.js"><link rel="prefetch" href="/assets/js/32.cc49be50.js"><link rel="prefetch" href="/assets/js/33.d1ff494d.js"><link rel="prefetch" href="/assets/js/34.2707ece9.js"><link rel="prefetch" href="/assets/js/35.f8c76f52.js"><link rel="prefetch" href="/assets/js/36.aef0f32e.js"><link rel="prefetch" href="/assets/js/37.1a9c5908.js"><link rel="prefetch" href="/assets/js/38.903136ce.js"><link rel="prefetch" href="/assets/js/39.36933768.js"><link rel="prefetch" href="/assets/js/4.e6adf6e6.js"><link rel="prefetch" href="/assets/js/40.596b11f9.js"><link rel="prefetch" href="/assets/js/41.49536e3a.js"><link rel="prefetch" href="/assets/js/42.85828572.js"><link rel="prefetch" href="/assets/js/43.34983cb7.js"><link rel="prefetch" href="/assets/js/44.7714ead4.js"><link rel="prefetch" href="/assets/js/45.abc50b11.js"><link rel="prefetch" href="/assets/js/46.0ea41615.js"><link rel="prefetch" href="/assets/js/47.e44eb3d6.js"><link rel="prefetch" href="/assets/js/48.aabe22c0.js"><link rel="prefetch" href="/assets/js/49.baff539a.js"><link rel="prefetch" href="/assets/js/5.1ed6628b.js"><link rel="prefetch" href="/assets/js/50.4d4f8933.js"><link rel="prefetch" href="/assets/js/51.294b130c.js"><link rel="prefetch" href="/assets/js/52.d3533b10.js"><link rel="prefetch" href="/assets/js/53.adc603a3.js"><link rel="prefetch" href="/assets/js/7.cce5be5e.js"><link rel="prefetch" href="/assets/js/8.897110a3.js"><link rel="prefetch" href="/assets/js/9.55f9e5df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82c487b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">时羽·前端知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/AlgorithmAndDataStructure/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Nodejs
</a></div><div class="nav-item"><a href="/extends/" class="nav-link">
  扩展
</a></div><div class="nav-item"><a href="https://github.com/ht1131589588/web-library" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/AlgorithmAndDataStructure/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Nodejs
</a></div><div class="nav-item"><a href="/extends/" class="nav-link">
  扩展
</a></div><div class="nav-item"><a href="https://github.com/ht1131589588/web-library" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/React/React使用总结.html" class="sidebar-link">React使用总结</a></li><li><a href="/front/React/Redux源码探索.html" class="sidebar-link">Redux 源码探索</a></li><li><a href="/front/React/React源码探索.html" class="sidebar-link">React 源码解读</a></li><li><a href="/front/React/Mobx使用总结.html" class="active sidebar-link">Mobx 使用总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#状态管理" class="sidebar-link">状态管理</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#redux-vs-mobx" class="sidebar-link">Redux Vs Mobx</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#先简单介绍一下-redux" class="sidebar-link">先简单介绍一下 Redux</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#接下来回到主题-mobx" class="sidebar-link">接下来回到主题 -- Mobx</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#redux-和-mobx-的对比" class="sidebar-link">Redux 和 Mobx 的对比</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#结语" class="sidebar-link">结语</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobx使用总结.html#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mobx-使用总结"><a href="#mobx-使用总结" aria-hidden="true" class="header-anchor">#</a> Mobx 使用总结</h1> <p>本文主要介绍 Mobx 的一些常见用法和理念，以及一些使用注意事项，还会对比 Redux 和 Mobx 各自的优势，本篇文章不会过多的讲解 Redux 我 Mobx 的源码，在文章结尾处有几篇对 Redux 和 Mobx 源码的分析的文章，有感兴趣的同学可以去看一下</p> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>如果你对为什么要使用 Redux 或者 Mobx 有疑惑的话，可以看一下下面这段解释：</p> <p>当我们使用 React 开发 web 应用程序时，在 React 组件内，可以使用 this.setState()和 this.state 处理或访问组件内状态，但是随着项目变大，状态变复杂，通常需要考虑组件间通信问题，主要包括以下两点：</p> <ol><li>某一个状态需要在多个组件间共享（访问，更新）；</li> <li>某组件内交互需要触发其他组件的状态更新；</li></ol> <p>关于这些问题，React 组件开发实践推荐将公用组件状态提升：</p> <p>通常多组件需要处理同一状态，我们推荐将共享状态提升至他们的共同最近祖先组件内。</p> <p>当项目越发复杂时，我们发现仅仅是提升状态已经无法适应如此复杂的状态管理了，程序状态变得比较难同步，操作，到处是回调，发布，订阅，这意味着我们需要更好的状态管理方式，于是就引入了状态管理库，如<code>Redux</code>，<code>Mobx</code>等。</p> <h2 id="状态管理"><a href="#状态管理" aria-hidden="true" class="header-anchor">#</a> 状态管理</h2> <p>状态管理库，无论是 Redux，还是 Mobx 这些，其本质都是为了解决状态管理混乱，无法有效同步的问题，它们都支持：</p> <ol><li>统一维护管理应用状态；</li> <li>某一状态只有一个可信数据来源，通常命名为 store，指状态容器；</li> <li>操作更新状态方式统一，并且可控，通常以 action 方式提供更新状态的途径；</li> <li>支持将 store 与 React 组件连接，如<code>react-redux</code>，<code>mobx-react</code>；通常使用状态管理库后，我们将 React 组件从业务上划分为两类：
<ol><li>容器组件（Container Components）：含有抽象数据而没有业务逻辑的组件；</li> <li>展示型组件（Presentation Components）：负责展示视图，视图交互回调内调用传入的处理函数；</li></ol></li></ol> <h2 id="redux-vs-mobx"><a href="#redux-vs-mobx" aria-hidden="true" class="header-anchor">#</a> Redux Vs Mobx</h2> <p>目前来看，Redux 已是 React 应用状态管理库中的霸主了，而 Mobx 则是一方诸侯，我们为什么要选择 Mobx，而不是继续沿用 Redux 呢，那就需要比较他们的异同了。
Mobx 和 Redux 都是 JavaScript 应用状态管理库，都适用于 React，Angular，VueJs 等框架或库，而不是局限于某一特定 UI 库。</p> <p>下面分别用 Redux 和 Mobx 实现一个 todo list，对比以下各自的实现方式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// redux todo list</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

type TTodo <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> number
  title<span class="token punctuation">:</span> string
<span class="token punctuation">}</span>

type TInitState <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 初始state</span>
<span class="token keyword">const</span> initState<span class="token punctuation">:</span> TInitState <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

type TAction <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> string
  payload<span class="token operator">?</span><span class="token punctuation">:</span> any
<span class="token punctuation">}</span>

<span class="token comment">// reducer</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> TAction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'init'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> todos<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">const</span> initTodos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TAction</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'init'</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'web前端'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">(</span>title<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TAction</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      title<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

type TProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span>
  dispatch<span class="token punctuation">:</span> Function
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>TProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">initTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> todos<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>todolist<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Input
            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> inputVal<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Button
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            Add
          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>List
          header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>TodoList<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>
          bordered
          dataSource<span class="token operator">=</span><span class="token punctuation">{</span>todos<span class="token punctuation">}</span>
          renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> TodoListView <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">:</span> TInitState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">:</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">ReduxApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ReduxApp<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>TodoListView <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ReduxApp
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mobx todo list</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

type TTodo <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> number
  title<span class="token punctuation">:</span> string
<span class="token punctuation">}</span>

<span class="token comment">// state</span>
<span class="token keyword">class</span> <span class="token class-name">TodoListState</span> <span class="token punctuation">{</span>
  @observable todos<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  @action <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'web前端'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  @action <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">todo<span class="token punctuation">:</span> TTodo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoListState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type TProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token operator">?</span><span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span>
  init<span class="token operator">?</span><span class="token punctuation">:</span> Function
  addTodo<span class="token operator">?</span><span class="token punctuation">:</span> Function
<span class="token punctuation">}</span>

@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stores<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">:</span> stores<span class="token punctuation">.</span>store<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
    init<span class="token punctuation">:</span> stores<span class="token punctuation">.</span>store<span class="token punctuation">.</span>init<span class="token punctuation">,</span>
    addTodo<span class="token punctuation">:</span> stores<span class="token punctuation">.</span>store<span class="token punctuation">.</span>addTodo<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>TProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>init<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> todos<span class="token punctuation">,</span> addTodo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>todolist<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Input
            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> inputVal<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Button
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              addTodo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                title<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            Add
          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>List
          header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>TodoList<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>
          bordered
          dataSource<span class="token operator">=</span><span class="token punctuation">{</span>todos<span class="token punctuation">}</span>
          renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">ReduxApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ReduxApp<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>TodoList <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ReduxApp
</code></pre></div><h2 id="先简单介绍一下-redux"><a href="#先简单介绍一下-redux" aria-hidden="true" class="header-anchor">#</a> 先简单介绍一下 Redux</h2> <p>要介绍 Redux，我们就不得不谈到 Flux 了</p> <p>Flux 是 Facebook 用来开发客户端-服务端 web 应用程序的应用架构，它更多是一种架构模式，而非一个特定框架。Flux 的核心思想就是：数据和逻辑永远单项流动。</p> <p><img src="/assets/img/flux2.5804ff54.png" alt="flux 模型"></p> <p>而 Redux 更多的是遵循 Flux 模式的一种实现，是一个 JavaScript 库，它关注点主要是以下几方面：</p> <ul><li>Action：一个 JavaScript 对象，描述动作相关信息，主要包含 type 属性和 payload 属性：
<ul><li>type：action 类型；</li> <li>payload：负载数据；</li></ul></li> <li>Reducer：定义应用状态如何响应不同动作（action），如何更新状态；</li> <li>Store：管理 action 和 reducer 及其关系的对象，主要提供以下功能：
<ul><li>维护应用状态并支持访问状态（getState()）；</li> <li>支持监听 action 的分发，更新状态（dispatch(action)）；</li> <li>支持订阅 store 的变更（subscribe(listener)）；</li></ul></li> <li>异步流：由于 Redux 所有对 store 状态的变更，都应该通过 action 触发，异步任务（通常都是业务或获取数据任务）也不例外，而为了不将业务或数据相关的任务混入 React 组件中，就需要使用其他框架配合管理异步任务流程，如<code>redux-thunk</code>，<code>redux-saga</code>等；</li></ul> <h2 id="接下来回到主题-mobx"><a href="#接下来回到主题-mobx" aria-hidden="true" class="header-anchor">#</a> 接下来回到主题 -- Mobx</h2> <p>接下来我分为以下几部来讲解 Mobx：</p> <ul><li>Mobx 是什么</li> <li>Mobx 核心概念</li> <li>在 React 里使用 Mobx</li></ul> <h3 id="mobx-是什么？"><a href="#mobx-是什么？" aria-hidden="true" class="header-anchor">#</a> Mobx 是什么？</h3> <p>Mobx 是一个通过函数响应式编程，让状态管理更加简单和容易拓展的状态管理库，它遵循一个简单的原则：</p> <p>Anything that can be derived from the application state, should be derived. Automatically.
任何可以从应用状态的获取的数据，都应该自动获取。</p> <h3 id="mobx-核心概念"><a href="#mobx-核心概念" aria-hidden="true" class="header-anchor">#</a> Mobx 核心概念</h3> <p><img src="/assets/img/flow.7c7e6d63.png" alt="mobx"></p> <p>核心原理：通过 action 触发 state 的变化，进而触发 state 的衍生(Derivations)对象(computed value &amp; Reactions)。</p> <p>可以看出，Mobx 的核心概念有以下几个：</p> <ul><li>State(状态) 对应业务的状态</li> <li>Action(动作) 是任一一段可以改变状态的代码。用户事件、后端数据推送、预定事件、等等。在 MobX 中可以显式地定义动作，它可以帮你把代码组织的更清晰。 如果是在严格模式下使用 MobX 的话，MobX 会强制只有在动作之中才可以修改状态。</li> <li>Derivations(衍生) 源自状态并且不会再有任何进一步的相互作用的东西就是衍生。MobX 区分了两种类型的衍生:
<ul><li>Computed values(计算值) - 它们是永远可以使用纯函数(pure function)从当前可观察状态中衍生出的值。</li> <li>Reactions(反应) - Reactions 是当状态改变时需要自动发生的副作用。需要有一个桥梁来连接命令式编程(imperative programming)和响应式编程(reactive programming)。或者说得更明确一些，它们最终都需要实现 I / O 操作。</li></ul></li></ul> <h4 id="state"><a href="#state" aria-hidden="true" class="header-anchor">#</a> State</h4> <p>在 Mobx 中，State 对应业务的状态，通过 observable，可以使这些状态变得可观察。</p> <p>通常支持被 observable 的类型有三个，分别是 Object, Array, Map，对于原始类型可以使用 <code>Obserable.box</code>。</p> <p>下面是针对 Object, Array, Map 的一个 🌰:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>

<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable timer <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">// 以上代码也可以写为，</span>
<span class="token comment">// class AppState {</span>
<span class="token comment">//   timer = 0</span>
<span class="token comment">// }</span>
<span class="token comment">// decorate(AppState, {</span>
<span class="token comment">//   timer: observable,</span>
<span class="token comment">// })</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  appState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timer<span class="token punctuation">:</span> number<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 注意了，这里直接改变了props的值，</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>timer <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Demo1<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>appState<span class="token punctuation">.</span>timer<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Demo1 appState<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>这可以说是一段完整的代码，但这种写法会有一个弊端，更改 state 的地方会比较散乱，当项目越来越大时，你根本难以定位到修改 state 的地方，这时候就需要统一定制修改 state 方式。</p> <h4 id="action"><a href="#action" aria-hidden="true" class="header-anchor">#</a> Action</h4> <p>在讲 State 时，有一个很大的弊端，如果不进行限制 state 修改的方式，当项目越来越大时，状态的变更会很难预测，在 redux 中，唯一可以更改 state 的途径便是 dispatch 一个 action。这种约束性带来的一个好处是可维护性。整个 state 只要改变必定是通过 action 触发的，对此只要找到 reducer 中对应的 action 便能找到影响数据改变的原因。而 mobx 中，也提供了这样一种方式。</p> <p>默认 Mobx 并不强制所有 state 的改变必须通过 action 来改变，这主要适用于一些较小的项目。对于较大型的，需要多人合作的项目来说，可以使用 Mobx 提供的 api configure 来强制，其中<code>enforceActions</code>就是用于设置改变状态的严格模式。
<code>enforceActions</code>有如下值：</p> <ul><li><code>never</code>(默认): 可以在任意地方修改状态</li> <li><code>observed</code>: 在某处观察到的所有状态都需要通过动作进行更改。在正式应用中推荐此严格模式。</li> <li><code>always</code>: 状态始终需要通过动作来更新(实际上还包括创建)</li></ul> <p><code>enforceActions</code>原理：通过改变全局的 strictMode 以及 allowStateChanges 属性的方式来实现强制使用 action。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> configure<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token comment">// 设置后如果不通过action进行修改就会有报错提示</span>
<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  enforceActions<span class="token punctuation">:</span> <span class="token string">'observed'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable timer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">// 添加action</span>
  @action <span class="token function-variable function">changeTimer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  appState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timer<span class="token punctuation">:</span> number
    changeTimer<span class="token punctuation">:</span> Function
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span><span class="token function">changeTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Demo2<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>appState<span class="token punctuation">.</span>timer<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Demo2 appState<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>设置只能通过 action 才能改变 state 时，那 Mobx 是如何进行异步处理呢？</p> <p>和 Redux 不同的是，Mobx 在异步处理上并不复杂，不需要引入额外的类似 redux-thunk、redux-saga 这样的库。
唯一需要注意的是，在严格模式下，对于异步 action 里的回调，若该回调也要修改 observable 的值，那么该回调也需要绑定 action。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> configure<span class="token punctuation">,</span> action<span class="token punctuation">,</span> runInAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  enforceActions<span class="token punctuation">:</span> <span class="token string">'observed'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable timer <span class="token operator">=</span> <span class="token number">0</span>
  @action <span class="token function-variable function">changeTimer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token operator">?</span><span class="token punctuation">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">+=</span> num <span class="token operator">||</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  @action <span class="token function-variable function">asyncChangeTimer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token operator">?</span><span class="token punctuation">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 直接改变也会报错，必须再次调用一个action方法来改变</span>
      <span class="token comment">// this.timer += num || 2 // 会报错</span>
      <span class="token comment">// 需要调用同步的action方法进行改变state，这里有三种方式</span>
      <span class="token comment">// 1. 调用已有action</span>
      <span class="token comment">// this.changeTimer(num)</span>
      <span class="token comment">// 2. 可以直接用action包裹</span>
      <span class="token comment">// action('actionAsyncChangeTimer', () =&gt; {</span>
      <span class="token comment">//   this.timer += num || 2</span>
      <span class="token comment">// })</span>
      <span class="token comment">// 3. 如果不想到处写action，可以使用Mobx提供的工具函数runInAction来简化操作。runInAction其实</span>
      <span class="token function">runInAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">+=</span> num <span class="token operator">||</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 注意，runInAction 还可以给定第一个参数作为名称。runInAction(f) 实际上是 action(f)() 的语法糖。</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  appState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timer<span class="token punctuation">:</span> number
    changeTimer<span class="token punctuation">:</span> Function
    asyncChangeTimer<span class="token punctuation">:</span> Function
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Demo2<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>appState<span class="token punctuation">.</span>timer<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span><span class="token function">changeTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          add
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span><span class="token function">asyncChangeTimer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          <span class="token keyword">async</span> add
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Demo2 appState<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>上面仅仅介绍了调用一个新的或者类似一个新的 action 进行异步处理，实际上可以直接用 async/await 方式进行处理</p> <div class="language-js extra-class"><pre class="language-js"><code>@action <span class="token function-variable function">asyncChangeTimer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token operator">?</span><span class="token punctuation">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> addNum <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeTimer</span><span class="token punctuation">(</span>addNum<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>action 的官方文档可以看这里：<a href="https://cn.mobx.js.org/refguide/action.html" target="_blank" rel="noopener noreferrer">https://cn.mobx.js.org/refguide/action.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
action 异步处理：<a href="https://cn.mobx.js.org/best/actions.html" target="_blank" rel="noopener noreferrer">https://cn.mobx.js.org/best/actions.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="computed"><a href="#computed" aria-hidden="true" class="header-anchor">#</a> computed</h4> <p>Mobx 中 state 的设计原则和 redux 有一点是相同的，那就是尽可能保证 state 足够小，足够原子。这样设计的原则不言而喻，无论是维护性还是性能。那么对于依赖 state 的数据而衍生出的数据，可以使用 computed。</p> <p>简而言之，你有一个值，该值的结果依赖于 state，并且该值也需要被 obserable，那么就使用 computed。</p> <p>通常应该尽可能的使用计算属性，并且由于其函数式的特点，可以最大化优化性能。如果计算属性依赖的 state 没改变，或者该计算值没有被其他计算值或响应（reaction）使用，computed 便不会运行。在这种情况下，computed 处于暂停状态，此时若该计算属性不再被 observable。那么其便会被 Mobx 垃圾回收。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> autorun<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Checkbox<span class="token punctuation">,</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">type</span> todo <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token builtin">number</span>
  title<span class="token punctuation">:</span> <span class="token builtin">string</span>
  checked<span class="token punctuation">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> TypeTodos <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>todo<span class="token operator">&gt;</span>

<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable todos<span class="token punctuation">:</span> TypeTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'haha'</span><span class="token punctuation">,</span> checked<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  @computed <span class="token keyword">get</span> <span class="token function">toDoLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'todos.length'</span><span class="token punctuation">,</span> appState<span class="token punctuation">.</span>todos<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'toDoLength'</span><span class="token punctuation">,</span> appState<span class="token punctuation">.</span>toDoLength<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
appState<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'haha-1'</span><span class="token punctuation">,</span> checked<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
appState<span class="token punctuation">.</span>todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> <span class="token string">'haha-1-replace'</span><span class="token punctuation">,</span>
  checked<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出如下：</span>
<span class="token comment">// 'todos.length' 2</span>
<span class="token comment">// 'toDoLength' 2</span>
<span class="token comment">// 'todos.length' 2</span>
</code></pre></div><p>最后一行其实只是改了数组中的一个值，但是也触发了 autorun 的执行。从上面可以看出，此时如果用 computed 便会解决该问题。</p> <h4 id="autorun"><a href="#autorun" aria-hidden="true" class="header-anchor">#</a> autorun</h4> <p>另一个响应 state 的 api 便是 autorun。和 computed 类似，每当依赖的值改变时，其都会改变。不同的是，autorun 没有了 computed 的优化（当然，依赖值未改变的情况下也不会重新运行，但不会被自动回收）。因此在使用场景来说，autorun 通常用来执行一些有副作用的。例如打印日志，更新 UI 等等。</p> <h4 id="reaction"><a href="#reaction" aria-hidden="true" class="header-anchor">#</a> reaction</h4> <p>Derivations 主要有两种类型组成：<code>computed</code> 和 <code>Reactions</code>。</p> <p><code>Reactions</code>还有一个 api 就叫做<code>reaction</code>，上面的<code>autorun</code>是通过 <code>reaction</code> 实现的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> autorun<span class="token punctuation">,</span> reaction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'todo1'</span><span class="token punctuation">,</span>
    done<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'todo2'</span><span class="token punctuation">,</span>
    done<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// reaction 的错误用法: 对 length 的变化作出反应, 而不是 title 的变化!</span>
<span class="token keyword">const</span> reaction1 <span class="token operator">=</span> <span class="token function">reaction</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> todos<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
  <span class="token parameter">length</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reaction 1:'</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// reaction 的正确用法: 对 length 和 title 的变化作出反应</span>
<span class="token keyword">const</span> reaction2 <span class="token operator">=</span> <span class="token function">reaction</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token parameter">titles</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reaction 2:'</span><span class="token punctuation">,</span> titles<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// autorun 对它函数中使用的任何东西作出反应</span>
<span class="token keyword">const</span> autorun1 <span class="token operator">=</span> <span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'autorun 1:'</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>autorun1<span class="token punctuation">,</span> reaction1<span class="token punctuation">,</span> reaction2<span class="token punctuation">)</span>

todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'todo3'</span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 输出:</span>
<span class="token comment">// reaction 1: todo1, todo2, todo3</span>
<span class="token comment">// reaction 2: todo1, todo2, todo3</span>
<span class="token comment">// autorun 1: todo1, todo2, todo3</span>

todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'todo1 haha'</span>
<span class="token comment">// 输出:</span>
<span class="token comment">// reaction 2: todo1 haha, todo2, todo3</span>
<span class="token comment">// autorun 1: todo1 haha, todo2, todo3</span>
</code></pre></div><p>在上面示例中，reaction1、reaction2 和 autorun1 都会对 todos 数组中的 todo 的添加、删除或替换作出反应。 但只有 reaction2 和 autorun 会对某个 todo 的 title 变化作出反应，因为在 reaction2 的数据表达式中使用了 title，而 reaction1 的数据表达式没有使用。 autorun 追踪完整的副作用，因此它将始终正确触发，但也更容易意外地访问相关数据</p> <p>粗略地讲，reaction 是 computed(expression).observe(action(sideEffect)) 或 autorun(() =&gt; action(sideEffect)(expression)) 的语法糖。</p> <h3 id="mobx-原理分析"><a href="#mobx-原理分析" aria-hidden="true" class="header-anchor">#</a> Mobx 原理分析</h3> <h2 id="redux-和-mobx-的对比"><a href="#redux-和-mobx-的对比" aria-hidden="true" class="header-anchor">#</a> Redux 和 Mobx 的对比</h2> <p>介绍完 Redux 和 Mobx，下面我们进行一下对比</p> <h3 id="函数式和面向对象"><a href="#函数式和面向对象" aria-hidden="true" class="header-anchor">#</a> 函数式和面向对象</h3> <p>Redux 更多的是遵循函数式编程（Functional Programming, FP）思想，而 Mobx 则更多从面相对象角度考虑问题。
Redux 提倡编写函数式代码，如 reducer 就是一个纯函数（pure function），如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>纯函数，接受输入，然后输出结果，除此之外不会有任何影响，也包括不会影响接收的参数；对于相同的输入总是输出相同的结果。</p> <p>Mobx 设计更多偏向于面向对象编程（OOP）和响应式编程（Reactive Programming），通常将状态包装成可观察对象，于是我们就可以使用可观察对象的所有能力，一旦状态对象变更，就能自动获得更新。</p> <h3 id="单一-store-和多-store"><a href="#单一-store-和多-store" aria-hidden="true" class="header-anchor">#</a> 单一 store 和多 store</h3> <p>store 是应用管理数据的地方，在 Redux 应用中，我们总是将所有共享的应用数据集中在一个大的 store 中，而 Mobx 则通常按模块将应用状态划分，在多个独立的 store 中管理。</p> <h3 id="javascript-对象和可观察对象"><a href="#javascript-对象和可观察对象" aria-hidden="true" class="header-anchor">#</a> JavaScript 对象和可观察对象</h3> <p>Redux 默认以 JavaScript 原生对象形式存储数据，而 Mobx 使用可观察对象：</p> <p>Redux 需要手动追踪所有状态对象的变更；
Mobx 中可以监听可观察对象，当其变更时将自动触发监听；</p> <h3 id="不可变（immutable）和可变（mutable）"><a href="#不可变（immutable）和可变（mutable）" aria-hidden="true" class="header-anchor">#</a> 不可变（Immutable）和可变（Mutable）</h3> <p>Redux 状态对象通常是不可变的（Immutable）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">REQUEST_POST</span><span class="token punctuation">:</span>
  	<span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      post<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>post
  	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
    retur nstate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们不能直接操作状态对象，而总是在原来状态对象基础上返回一个新的状态对象，这样就能很方便的返回应用上一状态；而 Mobx 中可以直接使用新值更新状态对象。</p> <h3 id="mobx-react-和-react-redux"><a href="#mobx-react-和-react-redux" aria-hidden="true" class="header-anchor">#</a> mobx-react 和 react-redux</h3> <p>使用 Redux 和 React 应用连接时，需要使用 react-redux 提供的 Provider 和 connect：</p> <ol><li>Provider：负责将 Store 注入 React 应用；</li> <li>connect：负责将 store state 注入容器组件，并选择特定状态作为容器组件 props 传递；</li></ol> <p>对于 Mobx 而言，同样需要两个步骤：</p> <ol><li>Provider：使用 mobx-react 提供的 Provider 将所有 stores 注入应用；</li> <li>使用 inject 将特定 store 注入某组件，store 可以传递状态或 action；然后使用 observer 保证组件能响应 store 中的可观察对象（observable）变更，即 store 更新，组件视图响应式更新。</li></ol> <h2 id="结语"><a href="#结语" aria-hidden="true" class="header-anchor">#</a> 结语</h2> <p>如果对 redux 或者 Mobx 的原理感兴趣，可以看一下以下文章：</p> <ul><li><a href="https://mp.weixin.qq.com/s/idWmfUbPVVqK7Yi0_9NC4A" target="_blank" rel="noopener noreferrer">完全理解 redux（从零实现一个 redux）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000013682735" target="_blank" rel="noopener noreferrer">用故事解读 Mobx 源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 我自己都还没来得及看 😂</li></ul> <p>最后分享一个开源库，我自己写的 redux 解决方案库，还没写多久，不够完善，大家看了欢迎给我提提建议：<a href="https://github.com/ht1131589588/demacia" target="_blank" rel="noopener noreferrer">https://github.com/ht1131589588/demacia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://cn.mobx.js.org/" target="_blank" rel="noopener noreferrer">Mobx 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a7fd72c5188257a766324ae" target="_blank" rel="noopener noreferrer">你需要 Mobx 还是 Redux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://tate-young.github.io/2019/03/20/react-mobx.html#reactions-%E5%8F%8D%E5%BA%94" target="_blank" rel="noopener noreferrer">MobX 简介<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a3e611a6fb9a0451239279d" target="_blank" rel="noopener noreferrer">Mobx —— React 状态管理另一条路<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/14/2020, 4:51:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front/React/React源码探索.html" class="prev">
        React 源码解读
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5e1dc976.js" defer></script><script src="/assets/js/2.654fa9b9.js" defer></script><script src="/assets/js/6.c776911c.js" defer></script>
  </body>
</html>
